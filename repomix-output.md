This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-11-10 22:04:07

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
app
  api
    v1
      auth_router.py
      booking_router.py
      flight_router.py
  controllers
    booking_controller.py
    flight_controller.py
    passenger_controller.py
    user_controller.py
  core
    config.py
    security.py
  db
    database.py
    session.py
  main.py
  models
    booking.py
    flight.py
    passenger.py
    user.py
  register_cleaner.py
  schemas
    booking_schema.py
    flight_schema.py
    passenger_schema.py
    user_schema.py
repomix-output.md
requirements.txt
```

# Repository Files


## app/api/v1/auth_router.py

```python
from fastapi import APIRouter, Depends, HTTPException, status
from sqlmodel import Session
from app.db.session import get_session
from app.schemas.user_schema import UserCreate, UserLogin, TokenResponse, UserResponse
from app.controllers.user_controller import create_user, authenticate_user
from app.core.security import decode_token, create_access_token, get_current_user

router = APIRouter(prefix="/auth", tags=["Аутентификация"])


@router.post("/register", response_model=UserResponse, status_code=status.HTTP_201_CREATED)
def register(data: UserCreate, session: Session = Depends(get_session)):
    """Регистрация нового пользователя"""
    user = create_user(data, session)
    return UserResponse(id=user.id, username=user.username, role=user.role)


@router.post("/login", response_model=TokenResponse)
def login(data: UserLogin = Depends(UserLogin.as_form), session: Session = Depends(get_session)):
    """Авторизация и получение токена"""
    return authenticate_user(data.username, data.password, session)


@router.post("/refresh", response_model=dict)
def refresh_token(refresh_token: str):
    """Обновление access токена"""
    username = decode_token(refresh_token)
    if not username:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Невалидный токен"
        )

    new_access_token = create_access_token(data={"sub": username})
    return {"accessToken": new_access_token, "tokenType": "bearer"}


@router.get("/me", response_model=UserResponse)
def get_me(current_user=Depends(get_current_user)):
    """Получение информации о текущем пользователе"""
    return UserResponse(
        id=current_user.id,
        username=current_user.username,
        role=current_user.role
    )
```

## app/api/v1/booking_router.py

```python
from fastapi import APIRouter, Depends, status, Response
from sqlmodel import Session
from app.db.session import get_session
from app.schemas.booking_schema import BookingCreate, BookingResponse
from app.controllers.booking_controller import *
from app.core.security import get_current_user
from typing import List

router = APIRouter(prefix="/bookings", tags=["Бронирование"])


@router.post("", response_model=BookingResponse, status_code=status.HTTP_201_CREATED)
def sell_ticket_endpoint(
    data: BookingCreate,
    session: Session = Depends(get_session),
    current_user = Depends(get_current_user)
):
    """Продажа билета"""
    booking = sell_ticket(data.flightId, data.passengerId, session)
    return BookingResponse(
        id=booking.id,
        bookingCode=booking.booking_code,
        flightId=booking.flight_id,
        passengerId=booking.passenger_id,
        createdAt=booking.created_at
    )


@router.delete("/{booking_id}", status_code=status.HTTP_204_NO_CONTENT)
def cancel_ticket_endpoint(
    booking_id: int,
    session: Session = Depends(get_session),
    current_user = Depends(get_current_user)
):
    """Отмена продажи билета"""
    cancel_ticket(booking_id, session)
    return Response(status_code=status.HTTP_204_NO_CONTENT)


@router.get("/by-flight/{flight_id}", response_model=List[BookingResponse])
def get_bookings_by_flight_endpoint(
    flight_id: int,
    session: Session = Depends(get_session)
):
    """Получение бронирований по рейсу"""
    bookings = get_bookings_by_flight(flight_id, session)
    return [
        BookingResponse(
            id=b.id,
            bookingCode=b.booking_code,
            flightId=b.flight_id,
            passengerId=b.passenger_id,
            createdAt=b.created_at
        )
        for b in bookings
    ]


@router.get("/by-passenger/{passport}", response_model=List[BookingResponse])
def get_bookings_by_passenger_endpoint(
    passport: str,
    session: Session = Depends(get_session)
):
    """Получение бронирований по паспорту пассажира"""
    bookings = get_bookings_by_passenger(passport, session)
    return [
        BookingResponse(
            id=b.id,
            bookingCode=b.booking_code,
            flightId=b.flight_id,
            passengerId=b.passenger_id,
            createdAt=b.created_at
        )
        for b in bookings
    ]
```

## app/api/v1/flight_router.py

```python
from fastapi import APIRouter, Depends, status, Response
from sqlmodel import Session
from app.db.session import get_session
from app.schemas.flight_schema import FlightCreate, FlightUpdate, FlightResponse
from app.controllers.flight_controller import *
from app.core.security import get_current_user, admin_required
from fastapi_pagination import Page
from fastapi_pagination.ext.sqlmodel import paginate
from typing import List

router = APIRouter(prefix="/flights", tags=["Авиарейсы"])


@router.post("", response_model=PassengerResponse, status_code=status.HTTP_201_CREATED)
def create_passenger_endpoint(
    data: PassengerCreate,
    session: Session = Depends(get_session),
    current_user = Depends(get_current_user)
):
    """Регистрация пассажира"""
    passenger = create_passenger(data, session)
    return PassengerResponse(
        id=passenger.id,
        passportNumber=passenger.passport_number,
        passportIssuedBy=passenger.passport_issued_by,
        passportIssueDate=passenger.passport_issue_date,
        fullName=passenger.full_name,
        birthDate=passenger.birth_date
    )


@router.get("", response_model=Page[PassengerResponse])
def get_passengers_endpoint(session: Session = Depends(get_session)):
    """Просмотр всех пассажиров с пагинацией"""
    return paginate(session, select(Passenger))


@router.get("/{passenger_id}", response_model=PassengerResponse)
def get_passenger_endpoint(passenger_id: int, session: Session = Depends(get_session)):
    """Получение пассажира по ID"""
    passenger = get_passenger_by_id(passenger_id, session)
    return PassengerResponse(
        id=passenger.id,
        passportNumber=passenger.passport_number,
        passportIssuedBy=passenger.passport_issued_by,
        passportIssueDate=passenger.passport_issue_date,
        fullName=passenger.full_name,
        birthDate=passenger.birth_date
    )


@router.get("/search/by-passport/{passport}", response_model=PassengerResponse)
def search_passenger_by_passport(passport: str, session: Session = Depends(get_session)):
    """Поиск пассажира по серии и номеру паспорта"""
    passenger = find_passenger_by_passport(passport, session)
    return PassengerResponse(
        id=passenger.id,
        passportNumber=passenger.passport_number,
        passportIssuedBy=passenger.passport_issued_by,
        passportIssueDate=passenger.passport_issue_date,
        fullName=passenger.full_name,
        birthDate=passenger.birth_date
    )


@router.get("/search/by-name/{name}", response_model=List[PassengerResponse])
def search_passengers_by_name_endpoint(name: str, session: Session = Depends(get_session)):
    """Поиск пассажиров по ФИО"""
    passengers = find_passengers_by_name(name, session)
    return [
        PassengerResponse(
            id=p.id,
            passportNumber=p.passport_number,
            passportIssuedBy=p.passport_issued_by,
            passportIssueDate=p.passport_issue_date,
            fullName=p.full_name,
            birthDate=p.birth_date
        )
        for p in passengers
    ]


@router.delete("/{passenger_id}", status_code=status.HTTP_204_NO_CONTENT)
def delete_passenger_endpoint(
    passenger_id: int,
    session: Session = Depends(get_session),
    current_user = Depends(admin_required)
):
    """Удаление пассажира (только для администратора)"""
    delete_passenger(passenger_id, session)
    return Response(status_code=status.HTTP_204_NO_CONTENT)
```

## app/controllers/booking_controller.py

```python
from sqlmodel import Session, select
from fastapi import HTTPException, status
from app.models.booking import Booking, generate_booking_code
from app.models.flight import Flight
from app.models.passenger import Passenger
from typing import List


def sell_ticket(flight_id: int, passenger_id: int, session: Session) -> Booking:
    """Продажа билета"""
    flight = session.get(Flight, flight_id)
    if not flight:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Рейс не найден"
        )

    if flight.free_seats <= 0:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="Нет свободных мест"
        )

    passenger = session.get(Passenger, passenger_id)
    if not passenger:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Пассажир не найден"
        )

    # Проверка на дубликат бронирования
    existing_booking = session.exec(
        select(Booking).where(
            Booking.flight_id == flight_id,
            Booking.passenger_id == passenger_id
        )
    ).first()

    if existing_booking:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="Билет уже куплен"
        )

    booking = Booking(
        booking_code=generate_booking_code(),
        flight_id=flight_id,
        passenger_id=passenger_id
    )

    flight.free_seats -= 1
    session.add(booking)
    session.add(flight)
    session.commit()
    session.refresh(booking)

    return booking


def cancel_ticket(booking_id: int, session: Session):
    """Отмена билета"""
    booking = session.get(Booking, booking_id)
    if not booking:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Бронирование не найдено"
        )

    flight = session.get(Flight, booking.flight_id)
    if flight:
        flight.free_seats += 1
        session.add(flight)

    session.delete(booking)
    session.commit()


def get_bookings_by_flight(flight_id: int, session: Session) -> List[Booking]:
    """Получение бронирований по рейсу"""
    return session.exec(
        select(Booking).where(Booking.flight_id == flight_id)
    ).all()


def get_bookings_by_passenger(passport: str, session: Session) -> List[Booking]:
    """Получение бронирований пассажира"""
    passenger = session.exec(
        select(Passenger).where(Passenger.passport_number == passport)
    ).first()

    if not passenger:
        return []

    return session.exec(
        select(Booking).where(Booking.passenger_id == passenger.id)
    ).all()
```

## app/controllers/flight_controller.py

```python
from sqlmodel import Session, select
from fastapi import HTTPException, status
from app.models.flight import Flight
from app.schemas.flight_schema import FlightCreate, FlightUpdate
from typing import List, Optional


def create_flight(data: FlightCreate, session: Session) -> Flight:
    """Создание рейса"""
    existing = session.exec(
        select(Flight).where(Flight.flight_number == data.flightNumber)
    ).first()

    if existing:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="Рейс с таким номером уже существует"
        )

    flight = Flight(
        flight_number=data.flightNumber,
        airline_name=data.airlineName,
        departure_airport_icao=data.departureAirportIcao,
        arrival_airport_icao=data.arrivalAirportIcao,
        departure_date=data.departureDate,
        departure_time=data.departureTime,
        total_seats=data.totalSeats,
        free_seats=data.freeSeats
    )
    session.add(flight)
    session.commit()
    session.refresh(flight)
    return flight


def get_all_flights(session: Session) -> List[Flight]:
    """Получение всех рейсов"""
    return session.exec(select(Flight)).all()


def get_flight_by_id(flight_id: int, session: Session) -> Flight:
    """Получение рейса по ID"""
    flight = session.get(Flight, flight_id)
    if not flight:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Рейс не найден"
        )
    return flight


def get_flight_by_number(flight_number: str, session: Session) -> Optional[Flight]:
    """Получение рейса по номеру"""
    flight = session.exec(
        select(Flight).where(Flight.flight_number == flight_number)
    ).first()

    if not flight:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Рейс не найден"
        )
    return flight


def update_flight(flight_id: int, data: FlightUpdate, session: Session) -> Flight:
    """Обновление рейса"""
    flight = session.get(Flight, flight_id)
    if not flight:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Рейс не найден"
        )

    update_data = data.dict(exclude_unset=True)
    for key, value in update_data.items():
        # Преобразование camelCase в snake_case
        snake_key = ''.join(['_' + c.lower() if c.isupper() else c for c in key]).lstrip('_')
        setattr(flight, snake_key, value)

    session.add(flight)
    session.commit()
    session.refresh(flight)
    return flight


def delete_flight(flight_id: int, session: Session):
    """Удаление рейса"""
    flight = session.get(Flight, flight_id)
    if not flight:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Рейс не найден"
        )

    session.delete(flight)
    session.commit()


def search_flights_by_arrival(airport_query: str, session: Session) -> List[Flight]:
    """Поиск рейсов по аэропорту прибытия"""
    flights = session.exec(
        select(Flight).where(Flight.arrival_airport_icao.contains(airport_query.upper()))
    ).all()
    return flights
```

## app/controllers/passenger_controller.py

```python
from sqlmodel import Session, select
from fastapi import HTTPException, status
from app.models.passenger import Passenger
from app.schemas.passenger_schema import PassengerCreate, PassengerUpdate
from typing import List


def create_passenger(data: PassengerCreate, session: Session) -> Passenger:
    """Создание пассажира"""
    existing = session.exec(
        select(Passenger).where(Passenger.passport_number == data.passportNumber)
    ).first()

    if existing:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="Пассажир с таким паспортом уже зарегистрирован"
        )

    passenger = Passenger(
        passport_number=data.passportNumber,
        passport_issued_by=data.passportIssuedBy,
        passport_issue_date=data.passportIssueDate,
        full_name=data.fullName,
        birth_date=data.birthDate
    )
    session.add(passenger)
    session.commit()
    session.refresh(passenger)
    return passenger


def get_all_passengers(session: Session) -> List[Passenger]:
    """Получение всех пассажиров"""
    return session.exec(select(Passenger)).all()


def get_passenger_by_id(passenger_id: int, session: Session) -> Passenger:
    """Получение пассажира по ID"""
    passenger = session.get(Passenger, passenger_id)
    if not passenger:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Пассажир не найден"
        )
    return passenger


def find_passenger_by_passport(passport: str, session: Session) -> Passenger:
    """Поиск пассажира по паспорту"""
    passenger = session.exec(
        select(Passenger).where(Passenger.passport_number == passport)
    ).first()

    if not passenger:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Пассажир не найден"
        )
    return passenger


def find_passengers_by_name(name: str, session: Session) -> List[Passenger]:
    """Поиск пассажиров по имени"""
    passengers = session.exec(
        select(Passenger).where(Passenger.full_name.contains(name))
    ).all()
    return passengers


def delete_passenger(passenger_id: int, session: Session):
    """Удаление пассажира"""
    passenger = session.get(Passenger, passenger_id)
    if not passenger:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Пассажир не найден"
        )

    session.delete(passenger)
    session.commit()
```

## app/controllers/user_controller.py

```python
from sqlmodel import Session, select
from fastapi import HTTPException, status
from app.models.user import User
from app.schemas.user_schema import UserCreate
from app.core.security import hash_password, verify_password, create_access_token, create_refresh_token
from typing import List


def create_user(data: UserCreate, session: Session) -> User:
    """Создание пользователя"""
    existing_user = session.exec(select(User).where(User.username == data.username)).first()
    if existing_user:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="Пользователь с таким именем уже существует"
        )

    user = User(
        username=data.username,
        password=hash_password(data.password),
        role=data.role
    )
    session.add(user)
    session.commit()
    session.refresh(user)
    return user


def authenticate_user(username: str, password: str, session: Session):
    """Аутентификация пользователя"""
    user = session.exec(select(User).where(User.username == username)).first()
    if not user or not verify_password(password, user.password):
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Неверный логин или пароль"
        )

    access_token = create_access_token(data={"sub": user.username})
    refresh_token = create_refresh_token(data={"sub": user.username})

    return {
        "accessToken": access_token,
        "refreshToken": refresh_token,
        "tokenType": "bearer"
    }


def get_all_users(session: Session) -> List[User]:
    """Получение всех пользователей"""
    return session.exec(select(User)).all()
```

## app/core/config.py

```python
from dotenv import load_dotenv
import os

load_dotenv()

SECRET_KEY = os.getenv("SECRET_KEY", "your-secret-key-change-in-production")
ALGORITHM = os.getenv("ALGORITHM", "HS256")
ACCESS_TOKEN_EXPIRE_MINUTES = int(os.getenv("ACCESS_TOKEN_EXPIRE_MINUTES", "30"))
DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://postgres:password@localhost:5432/airport_db")
```

## app/core/security.py

```python
from datetime import datetime, timedelta
from jose import jwt, JWTError
from passlib.context import CryptContext
from fastapi import Depends, HTTPException, status
from fastapi.security import OAuth2PasswordBearer
from sqlmodel import Session, select
from app.core.config import SECRET_KEY, ALGORITHM, ACCESS_TOKEN_EXPIRE_MINUTES
from app.db.session import get_session

pwd_context = CryptContext(schemes=["argon2"], deprecated="auto")
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/v1/auth/login")


def hash_password(password: str) -> str:
    """Хеширование пароля"""
    return pwd_context.hash(password)


def verify_password(plain_password: str, hashed_password: str) -> bool:
    """Проверка пароля"""
    return pwd_context.verify(plain_password, hashed_password)


def create_access_token(data: dict, expires_delta: timedelta = None):
    """Создание JWT токена"""
    to_encode = data.copy()
    expire = datetime.utcnow() + (expires_delta or timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES))
    to_encode.update({"exp": expire, "type": "access"})
    return jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)


def create_refresh_token(data: dict):
    """Создание refresh токена"""
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(days=7)
    to_encode.update({"exp": expire, "type": "refresh"})
    return jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)


def decode_token(token: str):
    """Декодирование токена"""
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        return payload.get("sub")
    except JWTError:
        return None


def get_current_user(token: str = Depends(oauth2_scheme), session: Session = Depends(get_session)):
    """Получение текущего пользователя по токену"""
    from app.models.user import User

    username = decode_token(token)
    if not username:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Невалидный токен"
        )

    user = session.exec(select(User).where(User.username == username)).first()
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Пользователь не найден"
        )
    return user


def admin_required(user=Depends(get_current_user)):
    """Проверка прав администратора"""
    if user.role != "admin":
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="Требуются права администратора"
        )
    return user
```

## app/db/database.py

```python
from sqlmodel import SQLModel, create_engine
from app.core.config import DATABASE_URL

engine = create_engine(DATABASE_URL, echo=False)


def init_db():
    """Инициализация базы данных"""
    SQLModel.metadata.create_all(engine)


def close_db():
    """Закрытие соединения с БД"""
    engine.dispose()


def get_engine():
    """Получение engine для миграций"""
    return engine
```

## app/db/session.py

```python
from sqlmodel import Session
from app.db.database import engine


def get_session():
    """Получение сессии БД"""
    with Session(engine) as session:
        yield session
```

## app/main.py

```python
from datetime import date, time
from app.db.database import create_db_and_tables, get_session
from app.models import flight, passenger
from app.controllers import (
    flight_controller,
    passenger_controller,
    booking_controller,
)
from app.views import (
flight_views,
passenger_views,
booking_views
)

def main():
    create_db_and_tables()

    # Используем контекстный менеджер
    with get_session() as session:

        print("=" * 60)

        print()
        print("[1] Регистрация авиарейса")
        flight1 = flight.Flight(
            flight_number="HU-227",
            airline_name="Aвиасейлс",
            departure_airport_icao="UUEE",
            arrival_airport_icao="UUDD",
            departure_date=date(2025, 6, 20),
            departure_time=time(9, 15),
            total_seats=180,
            free_seats=180,
        )
        flight1 = flight_controller.create_flight(session, flight1)
        print(f"Рейс {flight1.flight_number} добавлен")

        flight2 = flight.Flight(
            flight_number="G8-148",
            airline_name="АЭРОФЛОТ",
            departure_airport_icao="UUEE",
            arrival_airport_icao="UNNT",
            departure_date=date(2025, 6, 21),
            departure_time=time(14, 30),
            total_seats=150,
            free_seats=150,
        )
        flight2 = flight_controller.create_flight(session, flight2)
        print(f"Рейс {flight2.flight_number} добавлен")

        print()
        print("[3] Просмотр всех авиарейсов")
        all_flights = flight_controller.get_all_flights(session)
        flight_views.print_flight_list(all_flights)

        print()
        print("[10] Регистрация пассажиров")
        p1 = passenger.Passenger(
            passport_number="1234-567890",
            passport_issued_by="УФМС г. Екатеринбург",
            passport_issue_date=date(2018, 3, 12),
            full_name="Абоба Абобов Абобович",
            birth_date=date(1985, 7, 22),
        )
        p1 = passenger_controller.create_passenger(session, p1)
        print(f"Пассажир {p1.full_name} зарегистрирован")

        p2 = passenger.Passenger(
            passport_number="5678-123456",
            passport_issued_by="УФМС г. Москва",
            passport_issue_date=date(2020, 11, 5),
            full_name="Иванов Иван Иванович",
            birth_date=date(1992, 12, 3),
        )
        p2 = passenger_controller.create_passenger(session, p2)
        print(f"Пассажир {p2.full_name} зарегистрирован")

        print()
        print("[12] Просмотр всех пассажиров")
        all_passengers = passenger_controller.get_all_passengers(session)
        passenger_views.print_passenger_list(all_passengers)

        print()
        print("[4] Продажа билетов")
        b1 = booking_controller.sell_ticket(session, flight1.id, p1.id)
        if b1:
            print(f"Билет продан: бронь {b1.booking_code} на рейс {flight1.flight_number}")
        else:
            print("Не удалось продать билет")

        b2 = booking_controller.sell_ticket(session, flight1.id, p2.id)
        if b2:
            print(f"Билет продан: бронь {b2.booking_code} на рейс {flight1.flight_number}")
        else:
            print("Не удалось продать билет")

        print()
        print("[6] Поиск пассажира по паспорту (1234-567890)")
        found_passenger = passenger_controller.find_passenger_by_passport(session, "1234-567890")
        if found_passenger:
            bookings = booking_controller.get_bookings_by_passenger(session, "1234-567890")
            booking_views.print_passenger_details("1234-567890", found_passenger, bookings)
        else:
            print("Пассажир не найден")

        print()
        print("[7] Поиск пассажира по ФИО (содержит 'Иванов')")
        found_by_name = passenger_controller.find_passengers_by_name(session, "Иванов")
        passenger_views.print_passenger_list(found_by_name)

        print()
        print("[8] Поиск авиарейса по номеру (SU-123)")
        found_flight = flight_controller.get_flight_by_number(session, "HU-227")
        if found_flight:
            bookings_on_flight = booking_controller.get_bookings_by_flight(session, found_flight.id)
            passenger_ids = [b.passenger_id for b in bookings_on_flight]
            passengers_on_flight = []
            for pid in passenger_ids:
                p = session.get(passenger.Passenger, pid)
                if p:
                    passengers_on_flight.append(p)
            booking_views.print_flight_details(found_flight, passengers_on_flight)
        else:
            print("Рейс не найден")

        print()
        print("[5] Отмена билета")
        if b1:
            success = booking_controller.cancel_ticket(session, b1.id)
            if success:
                print("Билет отменён")
            else:
                print("Не удалось отменить билет")

        updated_flight = session.get(flight.Flight, flight1.id)
        print(f"После отмены: свободных мест на {flight1.flight_number} = {updated_flight.free_seats}")

        print()
        print("[11] Отмена регистрации пассажира")
        bookings_to_cancel = booking_controller.get_bookings_by_passenger(session, p2.passport_number)
        for b in bookings_to_cancel:
            booking_controller.cancel_ticket(session, b.id)
        deleted = passenger_controller.delete_passenger(session, p2.id)
        if deleted:
            print(f"Пассажир c паспортом {p2.passport_number} удалён")
        else:
            print("Пассажир не найден")

        print()
        #print("[13] Удаление всех пассажиров")
        #passenger_controller.delete_all_passengers(session)
        #print("Все пассажиры удалены")


# Запуск
if __name__ == "__main__":
    main()
```

## app/models/booking.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import datetime
from sqlalchemy import Column, Integer, ForeignKey

def generate_booking_code(length=6):
    import secrets
    import string
    chars = string.ascii_uppercase + string.digits
    return ''.join(secrets.choice(chars) for _ in range(length))

class Booking(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    booking_code: str
    flight_id: int = Field(foreign_key="flight.id")
    passenger_id: int = Field(
        sa_column=Column(Integer, ForeignKey("passenger.id", ondelete="CASCADE"))
    )
    created_at: datetime = Field(default_factory=datetime.utcnow)
```

## app/models/flight.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import date, time

class Flight(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    flight_number: str
    airline_name: str
    departure_airport_icao: str
    arrival_airport_icao: str
    departure_date: date
    departure_time: time
    total_seats: int
    free_seats: int
```

## app/models/passenger.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import date

class Passenger(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    passport_number: str
    passport_issued_by: str
    passport_issue_date: date
    full_name: str
    birth_date: date
```

## app/models/user.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import date


class User(SQLModel, table=True):
    """Модель пользователя"""
    id: Optional[int] = Field(default=None, primary_key=True)
    username: str = Field(unique=True, max_length=50)
    password: str = Field(max_length=200)
    role: str = Field(default="dispatcher", max_length=20)
    created_at: date = Field(default_factory=date.today)
```

## app/register_cleaner.py

```python

```

## app/schemas/booking_schema.py

```python

```

## app/schemas/flight_schema.py

```python
from pydantic import BaseModel, Field, field_validator
from datetime import date, time
from typing import Optional
import re


class FlightCreate(BaseModel):
    """Схема создания рейса"""
    flightNumber: str = Field(..., description="Номер рейса в формате AAA-NNN")
    airlineName: str = Field(..., max_length=100)
    departureAirportIcao: str = Field(..., min_length=4, max_length=4)
    arrivalAirportIcao: str = Field(..., min_length=4, max_length=4)
    departureDate: date
    departureTime: time
    totalSeats: int = Field(..., gt=0)
    freeSeats: int = Field(..., ge=0)

    @field_validator('flightNumber')
    def validate_flight_number(cls, v):
        pattern = r'^[A-Z]{2,3}-\d{3}$'
        if not re.match(pattern, v):
            raise ValueError('Номер рейса должен быть в формате AAA-NNN')
        return v


class FlightUpdate(BaseModel):
    """Схема обновления рейса"""
    flightNumber: Optional[str] = None
    airlineName: Optional[str] = None
    departureAirportIcao: Optional[str] = None
    arrivalAirportIcao: Optional[str] = None
    departureDate: Optional[date] = None
    departureTime: Optional[time] = None
    totalSeats: Optional[int] = None
    freeSeats: Optional[int] = None


class FlightResponse(BaseModel):
    """Схема ответа с данными рейса"""
    id: int
    flightNumber: str
    airlineName: str
    departureAirportIcao: str
    arrivalAirportIcao: str
    departureDate: date
    departureTime: time
    totalSeats: int
    freeSeats: int
```

## app/schemas/passenger_schema.py

```python
from pydantic import BaseModel, Field, field_validator
from datetime import date
from typing import Optional
import re


class PassengerCreate(BaseModel):
    """Схема создания пассажира"""
    passportNumber: str = Field(..., description="Номер паспорта NNNN-NNNNNN")
    passportIssuedBy: str = Field(..., max_length=200)
    passportIssueDate: date
    fullName: str = Field(..., max_length=200)
    birthDate: date

    @field_validator('passportNumber')
    def validate_passport(cls, v):
        pattern = r'^\d{4}-\d{6}$'
        if not re.match(pattern, v):
            raise ValueError('Номер паспорта должен быть в формате NNNN-NNNNNN')
        return v


class PassengerUpdate(BaseModel):
    """Схема обновления пассажира"""
    passportNumber: Optional[str] = None
    passportIssuedBy: Optional[str] = None
    passportIssueDate: Optional[date] = None
    fullName: Optional[str] = None
    birthDate: Optional[date] = None


class PassengerResponse(BaseModel):
    """Схема ответа с данными пассажира"""
    id: int
    passportNumber: str
    passportIssuedBy: str
    passportIssueDate: date
    fullName: str
    birthDate: date
```

## app/schemas/user_schema.py

```python
from pydantic import BaseModel, Field, field_validator
from fastapi import Form
import re


class UserCreate(BaseModel):
    """Схема создания пользователя"""
    username: str = Field(..., min_length=3, max_length=50)
    password: str = Field(..., min_length=8)
    role: str = Field(default="dispatcher")

    @field_validator('password')
    def password_complexity(cls, v):
        pattern = r'^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+=-]).{8,}$'
        if not re.match(pattern, v):
            raise ValueError('Пароль должен содержать буквы, цифры и спецсимволы, длина больше 8')
        return v


class UserLogin(BaseModel):
    """Схема авторизации"""
    username: str
    password: str

    @classmethod
    def as_form(
        cls,
        username: str = Form(..., description="Имя пользователя"),
        password: str = Form(..., description="Пароль")
    ):
        return cls(username=username, password=password)


class UserResponse(BaseModel):
    """Схема ответа с данными пользователя"""
    id: int
    username: str
    role: str


class TokenResponse(BaseModel):
    """Схема ответа с токенами"""
    accessToken: str
    refreshToken: str
    tokenType: str = "bearer"
```

## repomix-output.md

``````markdown
This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-11-10 21:34:15

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
app
  controllers
    booking_controller.py
    flight_controller.py
    passenger_controller.py
  db
    database.py
  main.py
  models
    booking.py
    flight.py
    passenger.py
  register_cleaner.py
  views
    booking_views.py
    flight_views.py
    passenger_views.py
repomix-output.md
```

# Repository Files


## app/controllers/booking_controller.py

```python
from sqlmodel import Session, select
from app.models.booking import Booking, generate_booking_code  # <-- импортируй функцию
from app.models.flight import Flight
from app.models.passenger import Passenger

def sell_ticket(session: Session, flight_id: int, passenger_id: int) -> Booking | None:
    flight = session.get(Flight, flight_id)
    if not flight or flight.free_seats <= 0:
        return None
    passenger = session.get(Passenger, passenger_id)
    if not passenger:
        return None

    # Явно генерируем код бронирования
    booking_code = generate_booking_code()

    booking = Booking(
        booking_code=booking_code,
        flight_id=flight_id,
        passenger_id=passenger_id
    )
    session.add(booking)
    flight.free_seats -= 1
    session.add(flight)
    return booking

def cancel_ticket(session: Session, booking_id: int) -> bool:
    booking = session.get(Booking, booking_id)
    if not booking:
        return False
    flight = session.get(Flight, booking.flight_id)
    if flight:
        flight.free_seats += 1
        session.add(flight)
    session.delete(booking)
    session.commit()
    return True

def get_bookings_by_flight(session: Session, flight_id: int):
    return session.exec(select(Booking).where(Booking.flight_id == flight_id)).all()

def get_bookings_by_passenger(session: Session, passport: str):
    passenger = session.exec(select(Passenger).where(Passenger.passport_number == passport)).first()
    if not passenger:
        return []
    return session.exec(select(Booking).where(Booking.passenger_id == passenger.id)).all()
```

## app/controllers/flight_controller.py

```python
from sqlmodel import Session, select
from app.models.flight import Flight

def create_flight(session: Session, flight: Flight) -> Flight:
    session.add(flight)
    session.commit()
    session.refresh(flight)
    return flight

def get_all_flights(session: Session):
    return session.exec(select(Flight)).all()

def get_flight_by_number(session: Session, flight_number: str):
    return session.exec(select(Flight).where(Flight.flight_number == flight_number)).first()

def delete_flight(session: Session, flight_id: int):
    flight = session.get(Flight, flight_id)
    if flight:
        session.delete(flight)
        session.commit()
    return flight
```

## app/controllers/passenger_controller.py

```python
from sqlmodel import Session, select
from app.models.passenger import Passenger

def create_passenger(session: Session, passenger: Passenger) -> Passenger:
    session.add(passenger)
    session.commit()
    session.refresh(passenger)
    return passenger

def delete_passenger(session: Session, passenger_id: int) -> bool:
    p = session.get(Passenger, passenger_id)
    if p:
        session.delete(p)
        session.commit()
        return True
    return False

def delete_all_passengers(session: Session):
    passengers = session.exec(select(Passenger)).all()
    for p in passengers:
        session.delete(p)
    session.commit()

def get_all_passengers(session: Session):
    return session.exec(select(Passenger)).all()

def find_passenger_by_passport(session: Session, passport: str):
    return session.exec(select(Passenger).where(Passenger.passport_number == passport)).first()

def find_passengers_by_name(session: Session, name: str):
    return session.exec(select(Passenger).where(Passenger.full_name.icontains(name))).all()
```

## app/db/database.py

```python
from sqlmodel import create_engine, SQLModel, Session
import os
from dotenv import load_dotenv
from contextlib import contextmanager

load_dotenv()

DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://postgres:password@localhost:5432/airport_db")

engine = create_engine(DATABASE_URL, echo=False)

def create_db_and_tables():
    SQLModel.metadata.create_all(engine)

@contextmanager
def get_session():
    session = Session(engine)
    try:
        yield session
        session.commit()
    except Exception:
        session.rollback()
        raise
    finally:
        session.close()
```

## app/main.py

```python
from datetime import date, time
from app.db.database import create_db_and_tables, get_session
from app.models import flight, passenger
from app.controllers import (
    flight_controller,
    passenger_controller,
    booking_controller,
)
from app.views import (
flight_views,
passenger_views,
booking_views
)

def main():
    create_db_and_tables()

    # Используем контекстный менеджер
    with get_session() as session:

        print("=" * 60)

        print()
        print("[1] Регистрация авиарейса")
        flight1 = flight.Flight(
            flight_number="HU-227",
            airline_name="Aвиасейлс",
            departure_airport_icao="UUEE",
            arrival_airport_icao="UUDD",
            departure_date=date(2025, 6, 20),
            departure_time=time(9, 15),
            total_seats=180,
            free_seats=180,
        )
        flight1 = flight_controller.create_flight(session, flight1)
        print(f"Рейс {flight1.flight_number} добавлен")

        flight2 = flight.Flight(
            flight_number="G8-148",
            airline_name="АЭРОФЛОТ",
            departure_airport_icao="UUEE",
            arrival_airport_icao="UNNT",
            departure_date=date(2025, 6, 21),
            departure_time=time(14, 30),
            total_seats=150,
            free_seats=150,
        )
        flight2 = flight_controller.create_flight(session, flight2)
        print(f"Рейс {flight2.flight_number} добавлен")

        print()
        print("[3] Просмотр всех авиарейсов")
        all_flights = flight_controller.get_all_flights(session)
        flight_views.print_flight_list(all_flights)

        print()
        print("[10] Регистрация пассажиров")
        p1 = passenger.Passenger(
            passport_number="1234-567890",
            passport_issued_by="УФМС г. Екатеринбург",
            passport_issue_date=date(2018, 3, 12),
            full_name="Абоба Абобов Абобович",
            birth_date=date(1985, 7, 22),
        )
        p1 = passenger_controller.create_passenger(session, p1)
        print(f"Пассажир {p1.full_name} зарегистрирован")

        p2 = passenger.Passenger(
            passport_number="5678-123456",
            passport_issued_by="УФМС г. Москва",
            passport_issue_date=date(2020, 11, 5),
            full_name="Иванов Иван Иванович",
            birth_date=date(1992, 12, 3),
        )
        p2 = passenger_controller.create_passenger(session, p2)
        print(f"Пассажир {p2.full_name} зарегистрирован")

        print()
        print("[12] Просмотр всех пассажиров")
        all_passengers = passenger_controller.get_all_passengers(session)
        passenger_views.print_passenger_list(all_passengers)

        print()
        print("[4] Продажа билетов")
        b1 = booking_controller.sell_ticket(session, flight1.id, p1.id)
        if b1:
            print(f"Билет продан: бронь {b1.booking_code} на рейс {flight1.flight_number}")
        else:
            print("Не удалось продать билет")

        b2 = booking_controller.sell_ticket(session, flight1.id, p2.id)
        if b2:
            print(f"Билет продан: бронь {b2.booking_code} на рейс {flight1.flight_number}")
        else:
            print("Не удалось продать билет")

        print()
        print("[6] Поиск пассажира по паспорту (1234-567890)")
        found_passenger = passenger_controller.find_passenger_by_passport(session, "1234-567890")
        if found_passenger:
            bookings = booking_controller.get_bookings_by_passenger(session, "1234-567890")
            booking_views.print_passenger_details("1234-567890", found_passenger, bookings)
        else:
            print("Пассажир не найден")

        print()
        print("[7] Поиск пассажира по ФИО (содержит 'Иванов')")
        found_by_name = passenger_controller.find_passengers_by_name(session, "Иванов")
        passenger_views.print_passenger_list(found_by_name)

        print()
        print("[8] Поиск авиарейса по номеру (SU-123)")
        found_flight = flight_controller.get_flight_by_number(session, "HU-227")
        if found_flight:
            bookings_on_flight = booking_controller.get_bookings_by_flight(session, found_flight.id)
            passenger_ids = [b.passenger_id for b in bookings_on_flight]
            passengers_on_flight = []
            for pid in passenger_ids:
                p = session.get(passenger.Passenger, pid)
                if p:
                    passengers_on_flight.append(p)
            booking_views.print_flight_details(found_flight, passengers_on_flight)
        else:
            print("Рейс не найден")

        print()
        print("[5] Отмена билета")
        if b1:
            success = booking_controller.cancel_ticket(session, b1.id)
            if success:
                print("Билет отменён")
            else:
                print("Не удалось отменить билет")

        updated_flight = session.get(flight.Flight, flight1.id)
        print(f"После отмены: свободных мест на {flight1.flight_number} = {updated_flight.free_seats}")

        print()
        print("[11] Отмена регистрации пассажира")
        bookings_to_cancel = booking_controller.get_bookings_by_passenger(session, p2.passport_number)
        for b in bookings_to_cancel:
            booking_controller.cancel_ticket(session, b.id)
        deleted = passenger_controller.delete_passenger(session, p2.id)
        if deleted:
            print(f"Пассажир c паспортом {p2.passport_number} удалён")
        else:
            print("Пассажир не найден")

        print()
        #print("[13] Удаление всех пассажиров")
        #passenger_controller.delete_all_passengers(session)
        #print("Все пассажиры удалены")


# Запуск
if __name__ == "__main__":
    main()
```

## app/models/booking.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import datetime
from sqlalchemy import Column, Integer, ForeignKey

def generate_booking_code(length=6):
    import secrets
    import string
    chars = string.ascii_uppercase + string.digits
    return ''.join(secrets.choice(chars) for _ in range(length))

class Booking(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    booking_code: str
    flight_id: int = Field(foreign_key="flight.id")
    passenger_id: int = Field(
        sa_column=Column(Integer, ForeignKey("passenger.id", ondelete="CASCADE"))
    )
    created_at: datetime = Field(default_factory=datetime.utcnow)
```

## app/models/flight.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import date, time

class Flight(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    flight_number: str
    airline_name: str
    departure_airport_icao: str
    arrival_airport_icao: str
    departure_date: date
    departure_time: time
    total_seats: int
    free_seats: int
```

## app/models/passenger.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import date

class Passenger(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    passport_number: str
    passport_issued_by: str
    passport_issue_date: date
    full_name: str
    birth_date: date
```

## app/register_cleaner.py

```python

```

## app/views/booking_views.py

```python
from typing import List
from app.models.passenger import Passenger


def print_passenger_details(passport: str, passenger: Passenger, bookings: List):
    print()
    print(f"Пассажир найден по паспорту: {passport}")
    print(f"ФИО: {passenger.full_name}")
    print(f"Дата рождения: {passenger.birth_date}")
    print(f"Место выдачи паспорта: {passenger.passport_issued_by}")
    print(f"Дата выдачи паспорта: {passenger.passport_issue_date}")

    if not bookings:
        print("Бронирований нет")
    else:
        print(f"Бронирований: {len(bookings)}")
        for b in bookings:
            print(f"Код бронирования: {b.booking_code}")
            print(f"Рейс ID: {b.flight_id}")
            print(f"Дата бронирования: {b.created_at}")
            print("----")


def print_flight_details(flight, passengers: List[Passenger]):
    print()
    print(f"Рейс найден по номеру: {flight.flight_number}")
    print(f"Авиакомпания: {flight.airline_name}")
    print(f"Аэропорт отправления (ИКАО): {flight.departure_airport_icao}")
    print(f"Аэропорт прибытия (ИКАО): {flight.arrival_airport_icao}")
    print(f"Дата отправления: {flight.departure_date}")
    print(f"Время отправления: {flight.departure_time}")
    print(f"Всего мест: {flight.total_seats}")
    print(f"Свободных мест: {flight.free_seats}")

    if not passengers:
        print("На рейсе нет пассажиров")
    else:
        print(f"Пассажиров на рейсе: {len(passengers)}")
        for p in passengers:
            print(f"ФИО: {p.full_name}")
            print(f"Паспорт: {p.passport_number}")
            print("----")
```

## app/views/flight_views.py

```python
from typing import List
from app.models.flight import Flight

def print_flight_list(flights: List[Flight]):
    if not flights:
        print("Нет зарегистрированных авиарейсов.")
        return

    print()
    print("СПИСОК АВИАРЕЙСОВ")
    for f in flights:
        print(f"ID: {f.id}")
        print(f"Номер рейса: {f.flight_number}")
        print(f"Авиакомпания: {f.airline_name}")
        print(f"Аэропорт отправления (ИКАО): {f.departure_airport_icao}")
        print(f"Аэропорт прибытия (ИКАО): {f.arrival_airport_icao}")
        print(f"Дата отправления: {f.departure_date}")
        print(f"Время отправления: {f.departure_time}")
        print(f"Всего мест: {f.total_seats}")
        print(f"Свободных мест: {f.free_seats}")
        print("-" * 40)
```

## app/views/passenger_views.py

```python
from typing import List
from app.models.passenger import Passenger

def print_passenger_list(passengers: List[Passenger]):
    if not passengers:
        print("Нет зарегистрированных пассажиров.")
        return

    print()
    print("СПИСОК ПАССАЖИРОВ")
    for p in passengers:
        print(f"ID: {p.id}")
        print(f"Паспорт: {p.passport_number}")
        print(f"ФИО: {p.full_name}")
        print(f"Дата рождения: {p.birth_date}")
        print(f"Место выдачи паспорта: {p.passport_issued_by}")
        print(f"Дата выдачи паспорта: {p.passport_issue_date}")
        print("-" * 40)
```

## repomix-output.md

`````markdown
This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-11-10 21:33:37

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
app
  controllers
    booking_controller.py
    flight_controller.py
    passenger_controller.py
  db
    database.py
  main.py
  models
    booking.py
    flight.py
    passenger.py
  register_cleaner.py
  views
    booking_views.py
    flight_views.py
    passenger_views.py
repomix-output.md
```

# Repository Files


## app/controllers/booking_controller.py

```python
from sqlmodel import Session, select
from app.models.booking import Booking, generate_booking_code  # <-- импортируй функцию
from app.models.flight import Flight
from app.models.passenger import Passenger

def sell_ticket(session: Session, flight_id: int, passenger_id: int) -> Booking | None:
    flight = session.get(Flight, flight_id)
    if not flight or flight.free_seats <= 0:
        return None
    passenger = session.get(Passenger, passenger_id)
    if not passenger:
        return None

    # Явно генерируем код бронирования
    booking_code = generate_booking_code()

    booking = Booking(
        booking_code=booking_code,
        flight_id=flight_id,
        passenger_id=passenger_id
    )
    session.add(booking)
    flight.free_seats -= 1
    session.add(flight)
    return booking

def cancel_ticket(session: Session, booking_id: int) -> bool:
    booking = session.get(Booking, booking_id)
    if not booking:
        return False
    flight = session.get(Flight, booking.flight_id)
    if flight:
        flight.free_seats += 1
        session.add(flight)
    session.delete(booking)
    session.commit()
    return True

def get_bookings_by_flight(session: Session, flight_id: int):
    return session.exec(select(Booking).where(Booking.flight_id == flight_id)).all()

def get_bookings_by_passenger(session: Session, passport: str):
    passenger = session.exec(select(Passenger).where(Passenger.passport_number == passport)).first()
    if not passenger:
        return []
    return session.exec(select(Booking).where(Booking.passenger_id == passenger.id)).all()
```

## app/controllers/flight_controller.py

```python
from sqlmodel import Session, select
from app.models.flight import Flight

def create_flight(session: Session, flight: Flight) -> Flight:
    session.add(flight)
    session.commit()
    session.refresh(flight)
    return flight

def get_all_flights(session: Session):
    return session.exec(select(Flight)).all()

def get_flight_by_number(session: Session, flight_number: str):
    return session.exec(select(Flight).where(Flight.flight_number == flight_number)).first()

def delete_flight(session: Session, flight_id: int):
    flight = session.get(Flight, flight_id)
    if flight:
        session.delete(flight)
        session.commit()
    return flight
```

## app/controllers/passenger_controller.py

```python
from sqlmodel import Session, select
from app.models.passenger import Passenger

def create_passenger(session: Session, passenger: Passenger) -> Passenger:
    session.add(passenger)
    session.commit()
    session.refresh(passenger)
    return passenger

def delete_passenger(session: Session, passenger_id: int) -> bool:
    p = session.get(Passenger, passenger_id)
    if p:
        session.delete(p)
        session.commit()
        return True
    return False

def delete_all_passengers(session: Session):
    passengers = session.exec(select(Passenger)).all()
    for p in passengers:
        session.delete(p)
    session.commit()

def get_all_passengers(session: Session):
    return session.exec(select(Passenger)).all()

def find_passenger_by_passport(session: Session, passport: str):
    return session.exec(select(Passenger).where(Passenger.passport_number == passport)).first()

def find_passengers_by_name(session: Session, name: str):
    return session.exec(select(Passenger).where(Passenger.full_name.icontains(name))).all()
```

## app/db/database.py

```python
from sqlmodel import create_engine, SQLModel, Session
import os
from dotenv import load_dotenv
from contextlib import contextmanager

load_dotenv()

DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://postgres:password@localhost:5432/airport_db")

engine = create_engine(DATABASE_URL, echo=False)

def create_db_and_tables():
    SQLModel.metadata.create_all(engine)

@contextmanager
def get_session():
    session = Session(engine)
    try:
        yield session
        session.commit()
    except Exception:
        session.rollback()
        raise
    finally:
        session.close()
```

## app/main.py

```python
from datetime import date, time
from app.db.database import create_db_and_tables, get_session
from app.models import flight, passenger
from app.controllers import (
    flight_controller,
    passenger_controller,
    booking_controller,
)
from app.views import (
flight_views,
passenger_views,
booking_views
)

def main():
    create_db_and_tables()

    # Используем контекстный менеджер
    with get_session() as session:

        print("=" * 60)

        print()
        print("[1] Регистрация авиарейса")
        flight1 = flight.Flight(
            flight_number="HU-227",
            airline_name="Aвиасейлс",
            departure_airport_icao="UUEE",
            arrival_airport_icao="UUDD",
            departure_date=date(2025, 6, 20),
            departure_time=time(9, 15),
            total_seats=180,
            free_seats=180,
        )
        flight1 = flight_controller.create_flight(session, flight1)
        print(f"Рейс {flight1.flight_number} добавлен")

        flight2 = flight.Flight(
            flight_number="G8-148",
            airline_name="АЭРОФЛОТ",
            departure_airport_icao="UUEE",
            arrival_airport_icao="UNNT",
            departure_date=date(2025, 6, 21),
            departure_time=time(14, 30),
            total_seats=150,
            free_seats=150,
        )
        flight2 = flight_controller.create_flight(session, flight2)
        print(f"Рейс {flight2.flight_number} добавлен")

        print()
        print("[3] Просмотр всех авиарейсов")
        all_flights = flight_controller.get_all_flights(session)
        flight_views.print_flight_list(all_flights)

        print()
        print("[10] Регистрация пассажиров")
        p1 = passenger.Passenger(
            passport_number="1234-567890",
            passport_issued_by="УФМС г. Екатеринбург",
            passport_issue_date=date(2018, 3, 12),
            full_name="Абоба Абобов Абобович",
            birth_date=date(1985, 7, 22),
        )
        p1 = passenger_controller.create_passenger(session, p1)
        print(f"Пассажир {p1.full_name} зарегистрирован")

        p2 = passenger.Passenger(
            passport_number="5678-123456",
            passport_issued_by="УФМС г. Москва",
            passport_issue_date=date(2020, 11, 5),
            full_name="Иванов Иван Иванович",
            birth_date=date(1992, 12, 3),
        )
        p2 = passenger_controller.create_passenger(session, p2)
        print(f"Пассажир {p2.full_name} зарегистрирован")

        print()
        print("[12] Просмотр всех пассажиров")
        all_passengers = passenger_controller.get_all_passengers(session)
        passenger_views.print_passenger_list(all_passengers)

        print()
        print("[4] Продажа билетов")
        b1 = booking_controller.sell_ticket(session, flight1.id, p1.id)
        if b1:
            print(f"Билет продан: бронь {b1.booking_code} на рейс {flight1.flight_number}")
        else:
            print("Не удалось продать билет")

        b2 = booking_controller.sell_ticket(session, flight1.id, p2.id)
        if b2:
            print(f"Билет продан: бронь {b2.booking_code} на рейс {flight1.flight_number}")
        else:
            print("Не удалось продать билет")

        print()
        print("[6] Поиск пассажира по паспорту (1234-567890)")
        found_passenger = passenger_controller.find_passenger_by_passport(session, "1234-567890")
        if found_passenger:
            bookings = booking_controller.get_bookings_by_passenger(session, "1234-567890")
            booking_views.print_passenger_details("1234-567890", found_passenger, bookings)
        else:
            print("Пассажир не найден")

        print()
        print("[7] Поиск пассажира по ФИО (содержит 'Иванов')")
        found_by_name = passenger_controller.find_passengers_by_name(session, "Иванов")
        passenger_views.print_passenger_list(found_by_name)

        print()
        print("[8] Поиск авиарейса по номеру (SU-123)")
        found_flight = flight_controller.get_flight_by_number(session, "HU-227")
        if found_flight:
            bookings_on_flight = booking_controller.get_bookings_by_flight(session, found_flight.id)
            passenger_ids = [b.passenger_id for b in bookings_on_flight]
            passengers_on_flight = []
            for pid in passenger_ids:
                p = session.get(passenger.Passenger, pid)
                if p:
                    passengers_on_flight.append(p)
            booking_views.print_flight_details(found_flight, passengers_on_flight)
        else:
            print("Рейс не найден")

        print()
        print("[5] Отмена билета")
        if b1:
            success = booking_controller.cancel_ticket(session, b1.id)
            if success:
                print("Билет отменён")
            else:
                print("Не удалось отменить билет")

        updated_flight = session.get(flight.Flight, flight1.id)
        print(f"После отмены: свободных мест на {flight1.flight_number} = {updated_flight.free_seats}")

        print()
        print("[11] Отмена регистрации пассажира")
        bookings_to_cancel = booking_controller.get_bookings_by_passenger(session, p2.passport_number)
        for b in bookings_to_cancel:
            booking_controller.cancel_ticket(session, b.id)
        deleted = passenger_controller.delete_passenger(session, p2.id)
        if deleted:
            print(f"Пассажир c паспортом {p2.passport_number} удалён")
        else:
            print("Пассажир не найден")

        print()
        #print("[13] Удаление всех пассажиров")
        #passenger_controller.delete_all_passengers(session)
        #print("Все пассажиры удалены")


# Запуск
if __name__ == "__main__":
    main()
```

## app/models/booking.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import datetime
from sqlalchemy import Column, Integer, ForeignKey

def generate_booking_code(length=6):
    import secrets
    import string
    chars = string.ascii_uppercase + string.digits
    return ''.join(secrets.choice(chars) for _ in range(length))

class Booking(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    booking_code: str
    flight_id: int = Field(foreign_key="flight.id")
    passenger_id: int = Field(
        sa_column=Column(Integer, ForeignKey("passenger.id", ondelete="CASCADE"))
    )
    created_at: datetime = Field(default_factory=datetime.utcnow)
```

## app/models/flight.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import date, time

class Flight(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    flight_number: str
    airline_name: str
    departure_airport_icao: str
    arrival_airport_icao: str
    departure_date: date
    departure_time: time
    total_seats: int
    free_seats: int
```

## app/models/passenger.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import date

class Passenger(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    passport_number: str
    passport_issued_by: str
    passport_issue_date: date
    full_name: str
    birth_date: date
```

## app/register_cleaner.py

```python

```

## app/views/booking_views.py

```python
from typing import List
from app.models.passenger import Passenger


def print_passenger_details(passport: str, passenger: Passenger, bookings: List):
    print()
    print(f"Пассажир найден по паспорту: {passport}")
    print(f"ФИО: {passenger.full_name}")
    print(f"Дата рождения: {passenger.birth_date}")
    print(f"Место выдачи паспорта: {passenger.passport_issued_by}")
    print(f"Дата выдачи паспорта: {passenger.passport_issue_date}")

    if not bookings:
        print("Бронирований нет")
    else:
        print(f"Бронирований: {len(bookings)}")
        for b in bookings:
            print(f"Код бронирования: {b.booking_code}")
            print(f"Рейс ID: {b.flight_id}")
            print(f"Дата бронирования: {b.created_at}")
            print("----")


def print_flight_details(flight, passengers: List[Passenger]):
    print()
    print(f"Рейс найден по номеру: {flight.flight_number}")
    print(f"Авиакомпания: {flight.airline_name}")
    print(f"Аэропорт отправления (ИКАО): {flight.departure_airport_icao}")
    print(f"Аэропорт прибытия (ИКАО): {flight.arrival_airport_icao}")
    print(f"Дата отправления: {flight.departure_date}")
    print(f"Время отправления: {flight.departure_time}")
    print(f"Всего мест: {flight.total_seats}")
    print(f"Свободных мест: {flight.free_seats}")

    if not passengers:
        print("На рейсе нет пассажиров")
    else:
        print(f"Пассажиров на рейсе: {len(passengers)}")
        for p in passengers:
            print(f"ФИО: {p.full_name}")
            print(f"Паспорт: {p.passport_number}")
            print("----")
```

## app/views/flight_views.py

```python
from typing import List
from app.models.flight import Flight

def print_flight_list(flights: List[Flight]):
    if not flights:
        print("Нет зарегистрированных авиарейсов.")
        return

    print()
    print("СПИСОК АВИАРЕЙСОВ")
    for f in flights:
        print(f"ID: {f.id}")
        print(f"Номер рейса: {f.flight_number}")
        print(f"Авиакомпания: {f.airline_name}")
        print(f"Аэропорт отправления (ИКАО): {f.departure_airport_icao}")
        print(f"Аэропорт прибытия (ИКАО): {f.arrival_airport_icao}")
        print(f"Дата отправления: {f.departure_date}")
        print(f"Время отправления: {f.departure_time}")
        print(f"Всего мест: {f.total_seats}")
        print(f"Свободных мест: {f.free_seats}")
        print("-" * 40)
```

## app/views/passenger_views.py

```python
from typing import List
from app.models.passenger import Passenger

def print_passenger_list(passengers: List[Passenger]):
    if not passengers:
        print("Нет зарегистрированных пассажиров.")
        return

    print()
    print("СПИСОК ПАССАЖИРОВ")
    for p in passengers:
        print(f"ID: {p.id}")
        print(f"Паспорт: {p.passport_number}")
        print(f"ФИО: {p.full_name}")
        print(f"Дата рождения: {p.birth_date}")
        print(f"Место выдачи паспорта: {p.passport_issued_by}")
        print(f"Дата выдачи паспорта: {p.passport_issue_date}")
        print("-" * 40)
```

## repomix-output.md

````markdown
This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-11-10 21:33:15

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
app
  controllers
    booking_controller.py
    flight_controller.py
    passenger_controller.py
  db
    database.py
  main.py
  models
    booking.py
    flight.py
    passenger.py
  register_cleaner.py
  views
    booking_views.py
    flight_views.py
    passenger_views.py
```

# Repository Files


## app/controllers/booking_controller.py

```python
from sqlmodel import Session, select
from app.models.booking import Booking, generate_booking_code  # <-- импортируй функцию
from app.models.flight import Flight
from app.models.passenger import Passenger

def sell_ticket(session: Session, flight_id: int, passenger_id: int) -> Booking | None:
    flight = session.get(Flight, flight_id)
    if not flight or flight.free_seats <= 0:
        return None
    passenger = session.get(Passenger, passenger_id)
    if not passenger:
        return None

    # Явно генерируем код бронирования
    booking_code = generate_booking_code()

    booking = Booking(
        booking_code=booking_code,
        flight_id=flight_id,
        passenger_id=passenger_id
    )
    session.add(booking)
    flight.free_seats -= 1
    session.add(flight)
    return booking

def cancel_ticket(session: Session, booking_id: int) -> bool:
    booking = session.get(Booking, booking_id)
    if not booking:
        return False
    flight = session.get(Flight, booking.flight_id)
    if flight:
        flight.free_seats += 1
        session.add(flight)
    session.delete(booking)
    session.commit()
    return True

def get_bookings_by_flight(session: Session, flight_id: int):
    return session.exec(select(Booking).where(Booking.flight_id == flight_id)).all()

def get_bookings_by_passenger(session: Session, passport: str):
    passenger = session.exec(select(Passenger).where(Passenger.passport_number == passport)).first()
    if not passenger:
        return []
    return session.exec(select(Booking).where(Booking.passenger_id == passenger.id)).all()
```

## app/controllers/flight_controller.py

```python
from sqlmodel import Session, select
from app.models.flight import Flight

def create_flight(session: Session, flight: Flight) -> Flight:
    session.add(flight)
    session.commit()
    session.refresh(flight)
    return flight

def get_all_flights(session: Session):
    return session.exec(select(Flight)).all()

def get_flight_by_number(session: Session, flight_number: str):
    return session.exec(select(Flight).where(Flight.flight_number == flight_number)).first()

def delete_flight(session: Session, flight_id: int):
    flight = session.get(Flight, flight_id)
    if flight:
        session.delete(flight)
        session.commit()
    return flight
```

## app/controllers/passenger_controller.py

```python
from sqlmodel import Session, select
from app.models.passenger import Passenger

def create_passenger(session: Session, passenger: Passenger) -> Passenger:
    session.add(passenger)
    session.commit()
    session.refresh(passenger)
    return passenger

def delete_passenger(session: Session, passenger_id: int) -> bool:
    p = session.get(Passenger, passenger_id)
    if p:
        session.delete(p)
        session.commit()
        return True
    return False

def delete_all_passengers(session: Session):
    passengers = session.exec(select(Passenger)).all()
    for p in passengers:
        session.delete(p)
    session.commit()

def get_all_passengers(session: Session):
    return session.exec(select(Passenger)).all()

def find_passenger_by_passport(session: Session, passport: str):
    return session.exec(select(Passenger).where(Passenger.passport_number == passport)).first()

def find_passengers_by_name(session: Session, name: str):
    return session.exec(select(Passenger).where(Passenger.full_name.icontains(name))).all()
```

## app/db/database.py

```python
from sqlmodel import create_engine, SQLModel, Session
import os
from dotenv import load_dotenv
from contextlib import contextmanager

load_dotenv()

DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://postgres:password@localhost:5432/airport_db")

engine = create_engine(DATABASE_URL, echo=False)

def create_db_and_tables():
    SQLModel.metadata.create_all(engine)

@contextmanager
def get_session():
    session = Session(engine)
    try:
        yield session
        session.commit()
    except Exception:
        session.rollback()
        raise
    finally:
        session.close()
```

## app/main.py

```python
from datetime import date, time
from app.db.database import create_db_and_tables, get_session
from app.models import flight, passenger
from app.controllers import (
    flight_controller,
    passenger_controller,
    booking_controller,
)
from app.views import (
flight_views,
passenger_views,
booking_views
)

def main():
    create_db_and_tables()

    # Используем контекстный менеджер
    with get_session() as session:

        print("=" * 60)

        print()
        print("[1] Регистрация авиарейса")
        flight1 = flight.Flight(
            flight_number="HU-227",
            airline_name="Aвиасейлс",
            departure_airport_icao="UUEE",
            arrival_airport_icao="UUDD",
            departure_date=date(2025, 6, 20),
            departure_time=time(9, 15),
            total_seats=180,
            free_seats=180,
        )
        flight1 = flight_controller.create_flight(session, flight1)
        print(f"Рейс {flight1.flight_number} добавлен")

        flight2 = flight.Flight(
            flight_number="G8-148",
            airline_name="АЭРОФЛОТ",
            departure_airport_icao="UUEE",
            arrival_airport_icao="UNNT",
            departure_date=date(2025, 6, 21),
            departure_time=time(14, 30),
            total_seats=150,
            free_seats=150,
        )
        flight2 = flight_controller.create_flight(session, flight2)
        print(f"Рейс {flight2.flight_number} добавлен")

        print()
        print("[3] Просмотр всех авиарейсов")
        all_flights = flight_controller.get_all_flights(session)
        flight_views.print_flight_list(all_flights)

        print()
        print("[10] Регистрация пассажиров")
        p1 = passenger.Passenger(
            passport_number="1234-567890",
            passport_issued_by="УФМС г. Екатеринбург",
            passport_issue_date=date(2018, 3, 12),
            full_name="Абоба Абобов Абобович",
            birth_date=date(1985, 7, 22),
        )
        p1 = passenger_controller.create_passenger(session, p1)
        print(f"Пассажир {p1.full_name} зарегистрирован")

        p2 = passenger.Passenger(
            passport_number="5678-123456",
            passport_issued_by="УФМС г. Москва",
            passport_issue_date=date(2020, 11, 5),
            full_name="Иванов Иван Иванович",
            birth_date=date(1992, 12, 3),
        )
        p2 = passenger_controller.create_passenger(session, p2)
        print(f"Пассажир {p2.full_name} зарегистрирован")

        print()
        print("[12] Просмотр всех пассажиров")
        all_passengers = passenger_controller.get_all_passengers(session)
        passenger_views.print_passenger_list(all_passengers)

        print()
        print("[4] Продажа билетов")
        b1 = booking_controller.sell_ticket(session, flight1.id, p1.id)
        if b1:
            print(f"Билет продан: бронь {b1.booking_code} на рейс {flight1.flight_number}")
        else:
            print("Не удалось продать билет")

        b2 = booking_controller.sell_ticket(session, flight1.id, p2.id)
        if b2:
            print(f"Билет продан: бронь {b2.booking_code} на рейс {flight1.flight_number}")
        else:
            print("Не удалось продать билет")

        print()
        print("[6] Поиск пассажира по паспорту (1234-567890)")
        found_passenger = passenger_controller.find_passenger_by_passport(session, "1234-567890")
        if found_passenger:
            bookings = booking_controller.get_bookings_by_passenger(session, "1234-567890")
            booking_views.print_passenger_details("1234-567890", found_passenger, bookings)
        else:
            print("Пассажир не найден")

        print()
        print("[7] Поиск пассажира по ФИО (содержит 'Иванов')")
        found_by_name = passenger_controller.find_passengers_by_name(session, "Иванов")
        passenger_views.print_passenger_list(found_by_name)

        print()
        print("[8] Поиск авиарейса по номеру (SU-123)")
        found_flight = flight_controller.get_flight_by_number(session, "HU-227")
        if found_flight:
            bookings_on_flight = booking_controller.get_bookings_by_flight(session, found_flight.id)
            passenger_ids = [b.passenger_id for b in bookings_on_flight]
            passengers_on_flight = []
            for pid in passenger_ids:
                p = session.get(passenger.Passenger, pid)
                if p:
                    passengers_on_flight.append(p)
            booking_views.print_flight_details(found_flight, passengers_on_flight)
        else:
            print("Рейс не найден")

        print()
        print("[5] Отмена билета")
        if b1:
            success = booking_controller.cancel_ticket(session, b1.id)
            if success:
                print("Билет отменён")
            else:
                print("Не удалось отменить билет")

        updated_flight = session.get(flight.Flight, flight1.id)
        print(f"После отмены: свободных мест на {flight1.flight_number} = {updated_flight.free_seats}")

        print()
        print("[11] Отмена регистрации пассажира")
        bookings_to_cancel = booking_controller.get_bookings_by_passenger(session, p2.passport_number)
        for b in bookings_to_cancel:
            booking_controller.cancel_ticket(session, b.id)
        deleted = passenger_controller.delete_passenger(session, p2.id)
        if deleted:
            print(f"Пассажир c паспортом {p2.passport_number} удалён")
        else:
            print("Пассажир не найден")

        print()
        #print("[13] Удаление всех пассажиров")
        #passenger_controller.delete_all_passengers(session)
        #print("Все пассажиры удалены")


# Запуск
if __name__ == "__main__":
    main()
```

## app/models/booking.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import datetime
from sqlalchemy import Column, Integer, ForeignKey

def generate_booking_code(length=6):
    import secrets
    import string
    chars = string.ascii_uppercase + string.digits
    return ''.join(secrets.choice(chars) for _ in range(length))

class Booking(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    booking_code: str
    flight_id: int = Field(foreign_key="flight.id")
    passenger_id: int = Field(
        sa_column=Column(Integer, ForeignKey("passenger.id", ondelete="CASCADE"))
    )
    created_at: datetime = Field(default_factory=datetime.utcnow)
```

## app/models/flight.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import date, time

class Flight(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    flight_number: str
    airline_name: str
    departure_airport_icao: str
    arrival_airport_icao: str
    departure_date: date
    departure_time: time
    total_seats: int
    free_seats: int
```

## app/models/passenger.py

```python
from sqlmodel import SQLModel, Field
from typing import Optional
from datetime import date

class Passenger(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    passport_number: str
    passport_issued_by: str
    passport_issue_date: date
    full_name: str
    birth_date: date
```

## app/register_cleaner.py

```python

```

## app/views/booking_views.py

```python
from typing import List
from app.models.passenger import Passenger


def print_passenger_details(passport: str, passenger: Passenger, bookings: List):
    print()
    print(f"Пассажир найден по паспорту: {passport}")
    print(f"ФИО: {passenger.full_name}")
    print(f"Дата рождения: {passenger.birth_date}")
    print(f"Место выдачи паспорта: {passenger.passport_issued_by}")
    print(f"Дата выдачи паспорта: {passenger.passport_issue_date}")

    if not bookings:
        print("Бронирований нет")
    else:
        print(f"Бронирований: {len(bookings)}")
        for b in bookings:
            print(f"Код бронирования: {b.booking_code}")
            print(f"Рейс ID: {b.flight_id}")
            print(f"Дата бронирования: {b.created_at}")
            print("----")


def print_flight_details(flight, passengers: List[Passenger]):
    print()
    print(f"Рейс найден по номеру: {flight.flight_number}")
    print(f"Авиакомпания: {flight.airline_name}")
    print(f"Аэропорт отправления (ИКАО): {flight.departure_airport_icao}")
    print(f"Аэропорт прибытия (ИКАО): {flight.arrival_airport_icao}")
    print(f"Дата отправления: {flight.departure_date}")
    print(f"Время отправления: {flight.departure_time}")
    print(f"Всего мест: {flight.total_seats}")
    print(f"Свободных мест: {flight.free_seats}")

    if not passengers:
        print("На рейсе нет пассажиров")
    else:
        print(f"Пассажиров на рейсе: {len(passengers)}")
        for p in passengers:
            print(f"ФИО: {p.full_name}")
            print(f"Паспорт: {p.passport_number}")
            print("----")
```

## app/views/flight_views.py

```python
from typing import List
from app.models.flight import Flight

def print_flight_list(flights: List[Flight]):
    if not flights:
        print("Нет зарегистрированных авиарейсов.")
        return

    print()
    print("СПИСОК АВИАРЕЙСОВ")
    for f in flights:
        print(f"ID: {f.id}")
        print(f"Номер рейса: {f.flight_number}")
        print(f"Авиакомпания: {f.airline_name}")
        print(f"Аэропорт отправления (ИКАО): {f.departure_airport_icao}")
        print(f"Аэропорт прибытия (ИКАО): {f.arrival_airport_icao}")
        print(f"Дата отправления: {f.departure_date}")
        print(f"Время отправления: {f.departure_time}")
        print(f"Всего мест: {f.total_seats}")
        print(f"Свободных мест: {f.free_seats}")
        print("-" * 40)
```

## app/views/passenger_views.py

```python
from typing import List
from app.models.passenger import Passenger

def print_passenger_list(passengers: List[Passenger]):
    if not passengers:
        print("Нет зарегистрированных пассажиров.")
        return

    print()
    print("СПИСОК ПАССАЖИРОВ")
    for p in passengers:
        print(f"ID: {p.id}")
        print(f"Паспорт: {p.passport_number}")
        print(f"ФИО: {p.full_name}")
        print(f"Дата рождения: {p.birth_date}")
        print(f"Место выдачи паспорта: {p.passport_issued_by}")
        print(f"Дата выдачи паспорта: {p.passport_issue_date}")
        print("-" * 40)
```

## Statistics

- Total Files: 12
- Total Characters: 13959
- Total Tokens: 0
````

## Statistics

- Total Files: 13
- Total Characters: 30354
- Total Tokens: 0
`````

## Statistics

- Total Files: 13
- Total Characters: 46809
- Total Tokens: 0
``````

## requirements.txt

```text
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlmodel==0.0.14
psycopg2-binary==2.9.9
python-dotenv==1.0.0
python-jose[cryptography]==3.3.0
passlib[argon2]==1.7.4
argon2-cffi==23.1.0
python-multipart==0.0.6
email-validator==2.1.0
fastapi-pagination==0.12.13
```

## Statistics

- Total Files: 23
- Total Characters: 81880
- Total Tokens: 0
